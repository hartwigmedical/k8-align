#!/usr/bin/env bash

function printUsage(){
    echo "USAGE: $0 run"
    exit 1
}

function run() {
    pod_name="$(echo "k8-align-test" | awk '{print tolower($0)}')"
    clean_pod_name="$(echo "${pod_name}" | tr '_' '-' | tr '[:upper:]' '[:lower:]' | tr '.' '-')"

    # Make sure correct credentials are available
    gcloud container clusters get-credentials rerun-cluster --region europe-west4 --project hmf-crunch || exit 1

    sed \
    -e "s/VAR_POD_NAME/${clean_pod_name}/g" \
    k8/hmf-crunch/deploy.yaml \
    | kubectl create -f -
}

if [ $# -lt 1 ]; then  # TODO: bump this back up if there are actual arguments
  printUsage
fi

CMD=$1 && shift

case $CMD in
run)
    run "$@"
    ;;
*)
    printUsage
    ;;
esac